<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Hub Manga</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #20232A; color: #eee; font-family: Arial, sans-serif; }
    .hub-container { max-width: 700px; margin: 40px auto; background: #181a1f; padding: 32px 24px; border-radius: 14px; box-shadow: 0 2px 14px #000a;}
    h1 { color: #ffd700; }
    select, button { font-size: 1em; padding: 7px 16px; margin: 10px 0;}
    .chapter-list { margin-top: 30px; }
    .chapter-link { display: block; background: #292d37; color: #ffd700; padding: 12px 14px; border-radius: 8px; margin-bottom: 10px; text-decoration: none; }
    .chapter-link:hover { background: #ffd700; color: #222; }
    .cover { width: 180px; float:right; margin-left:30px; border-radius:11px; box-shadow:0 2px 14px #0008; }
    .desc { margin-bottom: 24px; }
  </style>
</head>
<body>
  <div class="hub-container">
    <img id="cover" class="cover" src="" alt="Couverture" style="display:none;">
    <h1 id="mangaTitle"></h1>
    <div class="desc" id="mangaDesc"></div>
    <label for="langSelect">Langue :</label>
    <select id="langSelect"></select>
    <div class="chapter-list" id="chapterList"></div>
  </div>
  <script src="mangas-data.js"></script>
  <script>
    // Utilitaire pour lire l'id dans l'URL (?id=...)
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    const mangaId = getQueryParam('id');
    // Cherche le manga dans le tableau
    const manga = mangas.find(m => m.id === mangaId);

    const titleElem = document.getElementById('mangaTitle');
    const coverElem = document.getElementById('cover');
    const descElem = document.getElementById('mangaDesc');
    const langSelect = document.getElementById('langSelect');
    const chapterList = document.getElementById('chapterList');

    if (!manga) {
      titleElem.textContent = "Manga introuvable";
      descElem.textContent = "Le manga demandé n'existe pas.";
    } else {
      titleElem.textContent = manga.title;
      if (manga.cover) {
        coverElem.src = manga.cover;
        coverElem.style.display = "";
      }
      descElem.textContent = manga.description || ""; // optionnel

      // Remplit les langues
      manga.languages.forEach(lang => {
        const opt = document.createElement('option');
        opt.value = lang.code;
        opt.textContent = lang.label;
        langSelect.appendChild(opt);
      });

      function renderChapters(langCode) {
        chapterList.innerHTML = "";
        const lang = manga.languages.find(l => l.code === langCode);
        if (!lang) return;
        lang.chapters.forEach(chap => {
          const a = document.createElement('a');
          a.className = "chapter-link";
          a.textContent = `Chap. ${chap.num} — ${chap.title}`;
          // On passe tous les paramètres au reader
          a.href = `reader.html?manga=${encodeURIComponent(manga.id)}&lang=${encodeURIComponent(lang.code)}&chapter=${chap.num}`;
          chapterList.appendChild(a);
        });
      }

      langSelect.addEventListener('change', () => renderChapters(langSelect.value));
      // Initialisation
      renderChapters(langSelect.value = manga.languages[0].code);
    }
  </script>
</body>
</html>
